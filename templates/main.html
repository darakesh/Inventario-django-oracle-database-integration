{% load crispy_forms_tags%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Inventory</title>
    <script>
        function del(pcode,pid){
            check =  confirm("do you want to delete "+ pcode + " this product?"); 
            if(check == true){
                window.location.href =  "http://127.0.0.1:8000/delete/" + encodeURIComponent(pid) + "/";
            } 
        }
    </script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>

<body style=" background-color : ghostwhite">
    <div style = " display:flex; align-items:center; justify-content:center; height:1000px">
        <div>
            <div class = jumbotron>
                <h1 align ="center">Product Inventory</h1>
                <hr>
                <h4>No of Items : {{productCount}}</h4>
            </div>
            {% for message in messages %}
                <p class="alert alert-success" role="alert">{{message}}<p>
            {% endfor %}
            {% if products %}
            <table class= "table table-striped">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">S.NO</th>
                        <th scope="col">Product Code</th>
                        <th scope="col">Product Name</th>
                        <th scope="col">Quantity</th>
                        <th scope="col">Options</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                    <tr>
                        <td scope="row">{{forloop.counter0|add:products.start_index }}</td>
                        <td>{{product.product_code}}</td>
                        <td>{{product.name}}</td>
                        <td>{{product.quantity}}</td>
                        <td> <a href="{% url 'edit' product.id %}"><button class="btn btn-info">Edit</button></a>  <button class= "btn btn-outline-danger" onclick="del('{{product.product_code}}','{{product.id}}')")>Delete</button></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="card" style="background-color:palegreen">
                <div class="card-body">
                    <h5> WOW!!! Your inventory is empty. Add Products. </h5>
                </div>
            </div>
            {% endif %}

            {% if products.has_other_pages %}
                <ul class="pagination pagination-sm justify-content-end">
                {% if products.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{products.previous_page_number}}" aria-label="Previous">
                      <span aria-hidden="true">&laquo;</span>
                      <span class="sr-only">Previous</span>
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <a class="page-link" href="" aria-label="Previous">
                      <span aria-hidden="true">&laquo;</span>
                      <span class="sr-only">Previous</span>
                    </a>
                </li>
                {% endif %}
                {% for i in products.paginator.page_range %}
                    {% if products.number == i %}
                    <li class="page-item active">
                        <a class="page-link" href="" >{{i}}<span class="sr-only">(current)</span></a>
                    </li>
                    {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{i}}">{{ i }}</a></li>
                    {% endif %}
                {% endfor %}    
                {% if products.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{products.next_page_number}}" aria-label="Next">
                      <span aria-hidden="true">&raquo;</span>
                      <span class="sr-only">Next</span>
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <a class="page-link" href=""aria-label="Next">
                      <span aria-hidden="true">&raquo;</span>
                      <span class="sr-only">Next</span>
                    </a>
                </li>
                {% endif %}
                </ul>
            {% endif %}

            <div>
                <form method = "POST">
                {% csrf_token %}
                {{productform|crispy}}
                {% if btnval == "Save"%}
                    <input class="btn btn-primary" type="submit" name="btn" value= {{btnval}} >
                    <a  href="{% url 'home'%}"><input class="btn btn-outline-secondary" type="button" value="Back"></a>
                {% else %}
                    <input class="btn btn-success" type="submit" name="btn" value= {{btnval}} >
                {% endif %}
                </form>
            </div>
        </div>
    </div>
</body>
</html>